/* $Id$ */

/**
 * AI Assistant Application CSS
 * Compatible with EGroupware themes - Basic styles with Shoelace enhancements
 */

/* Override EGroupware frame constraints for proper scrolling */
body.aiassistant,
.egw_fw_content_browser_iframe,
.et2_container,
.et2_container > div {
	overflow: visible !important;
	height: auto !important;
}

/* Ensure the main container works within EGroupware's layout */
.et2_container .aiassistant_container {
	height: calc(100vh - 120px) !important;
	max-height: none !important;
	overflow: hidden !important;
}

/* Basic container styling */
.aiassistant_container {
	display: flex;
	flex-direction: column;
	height: calc(100vh - 100px); /* Ensure container has proper height */
	max-height: 800px;
	padding: var(--sl-spacing-medium, 1rem);
	background: var(--sl-color-neutral-0, #ffffff);
	font-family: var(--sl-font-sans, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif);
	overflow: hidden; /* Prevent container from scrolling */
}

/* Header section */
.aiassistant_container .aiassistant_header {
	background: var(--sl-color-primary-600, #0ea5e9);
	color: var(--sl-color-neutral-0, #ffffff);
	padding: var(--sl-spacing-small, 0.75rem) var(--sl-spacing-medium, 1rem);
	border-bottom: var(--sl-input-border-width, 1px) solid var(--sl-color-neutral-200, #e2e8f0);
	border-radius: var(--sl-border-radius-medium, 0.25rem) var(--sl-border-radius-medium, 0.25rem) 0 0;
	display: flex;
	align-items: center;
	justify-content: space-between;
	box-shadow: var(--sl-shadow-small, 0 1px 2px rgba(0,0,0,0.05));
}

.aiassistant_container .aiassistant_title {
	font-size: var(--sl-font-size-large, 1.25rem);
	font-weight: var(--sl-font-weight-semibold, 500);
	margin: 0;
	color: inherit;
}

.aiassistant_container .aiassistant_status_indicator {
	background: rgba(255, 255, 255, 0.2);
	padding: var(--sl-spacing-3x-small, 0.125rem) var(--sl-spacing-x-small, 0.5rem);
	border-radius: var(--sl-border-radius-pill, 9999px);
	font-size: var(--sl-font-size-x-small, 0.75rem);
	font-weight: var(--sl-font-weight-semibold, 500);
	color: inherit;
}

/* Messages container */
.aiassistant_container .aiassistant_messages {
	flex: 1;
	overflow-y: auto; /* Enable vertical scrolling */
	overflow-x: hidden; /* Prevent horizontal scrolling */
	padding: var(--sl-spacing-large, 1.25rem);
	background: var(--sl-color-neutral-50, #f8fafc);
	border-left: var(--sl-input-border-width, 1px) solid var(--sl-color-neutral-200, #e2e8f0);
	border-right: var(--sl-input-border-width, 1px) solid var(--sl-color-neutral-200, #e2e8f0);
	min-height: 400px;
	max-height: calc(100vh - 200px); /* Ensure scrolling within viewport */
	scrollbar-width: thin; /* Firefox */
	scrollbar-color: var(--sl-color-neutral-300, #cbd5e1) var(--sl-color-neutral-100, #f1f5f9); /* Firefox */
}

/* Webkit scrollbar styling for better appearance */
.aiassistant_container .aiassistant_messages::-webkit-scrollbar {
	width: 8px;
}

.aiassistant_container .aiassistant_messages::-webkit-scrollbar-track {
	background: var(--sl-color-neutral-100, #f1f5f9);
	border-radius: 4px;
}

.aiassistant_container .aiassistant_messages::-webkit-scrollbar-thumb {
	background: var(--sl-color-neutral-300, #cbd5e1);
	border-radius: 4px;
}

.aiassistant_container .aiassistant_messages::-webkit-scrollbar-thumb:hover {
	background: var(--sl-color-neutral-400, #9ca3af);
}

/* Force vertical stacking of messages */
.aiassistant_container .aiassistant_messages > * {
	display: block;
	width: 100%;
	margin-bottom: var(--sl-spacing-medium, 1rem);
}

.aiassistant_container .aiassistant_messages > *:last-child {
	margin-bottom: 0;
}

/* Message alignment */
.aiassistant_container .aiassistant_messages > *[align="left"] {
	text-align: left;
}

.aiassistant_container .aiassistant_messages > *[align="right"] {
	text-align: right;
}

.aiassistant_container .aiassistant_messages > *[align="center"] {
	text-align: center;
}

/* et2-vbox styling */
.aiassistant_container et2-vbox#messages_container,
.aiassistant_container et2-vbox.aiassistant_messages,
.aiassistant_container #messages_container {
	display: flex;
	flex-direction: column;
	width: 100%;
	height: 100%;
	overflow-y: auto; /* Enable scrolling on the messages container */
	overflow-x: hidden;
	scrollbar-width: thin; /* Firefox */
	scrollbar-color: var(--sl-color-neutral-300, #cbd5e1) var(--sl-color-neutral-100, #f1f5f9); /* Firefox */
}

/* Ensure messages container can scroll */
.aiassistant_container et2-vbox#messages_container::-webkit-scrollbar,
.aiassistant_container et2-vbox.aiassistant_messages::-webkit-scrollbar,
.aiassistant_container #messages_container::-webkit-scrollbar {
	width: 8px;
}

.aiassistant_container et2-vbox#messages_container::-webkit-scrollbar-track,
.aiassistant_container et2-vbox.aiassistant_messages::-webkit-scrollbar-track,
.aiassistant_container #messages_container::-webkit-scrollbar-track {
	background: var(--sl-color-neutral-100, #f1f5f9);
	border-radius: 4px;
}

.aiassistant_container et2-vbox#messages_container::-webkit-scrollbar-thumb,
.aiassistant_container et2-vbox.aiassistant_messages::-webkit-scrollbar-thumb,
.aiassistant_container #messages_container::-webkit-scrollbar-thumb {
	background: var(--sl-color-neutral-300, #cbd5e1);
	border-radius: 4px;
}

.aiassistant_container et2-vbox#messages_container::-webkit-scrollbar-thumb:hover,
.aiassistant_container et2-vbox.aiassistant_messages::-webkit-scrollbar-thumb:hover,
.aiassistant_container #messages_container::-webkit-scrollbar-thumb:hover {
	background: var(--sl-color-neutral-400, #9ca3af);
}

/* Empty state */
.aiassistant_container .aiassistant_empty_state {
	text-align: center;
	padding: var(--sl-spacing-2x-large, 2.25rem);
	color: var(--sl-color-neutral-600, #475569);
}

.aiassistant_container .aiassistant_empty_state .aiassistant_empty_icon {
	font-size: var(--sl-font-size-4x-large, 4.5rem);
	margin-bottom: var(--sl-spacing-medium, 1rem);
}

.aiassistant_container .aiassistant_empty_state .aiassistant_empty_title {
	font-size: var(--sl-font-size-x-large, 1.5rem);
	font-weight: var(--sl-font-weight-semibold, 500);
	margin-bottom: var(--sl-spacing-small, 0.75rem);
	color: var(--sl-color-neutral-700, #374151);
}

.aiassistant_container .aiassistant_empty_state .aiassistant_empty_text {
	font-size: var(--sl-font-size-medium, 1rem);
	line-height: var(--sl-line-height-normal, 1.8);
	max-width: 500px;
	margin: 0 auto;
}

/* Message timestamp */

/* Message layout */
.aiassistant_container .aiassistant_message,
.aiassistant_container .message_group {
	margin-bottom: var(--sl-spacing-medium, 1rem);
	display: flex;
	width: 100%;
	clear: both;
	gap: var(--sl-spacing-small, 0.75rem);
}

/* User messages (right-aligned) */
.aiassistant_container .aiassistant_message.user,
.aiassistant_container .message_group.user {
	justify-content: flex-end;
	text-align: right;
}

.aiassistant_container .aiassistant_message.user .aiassistant_message_content,
.aiassistant_container .aiassistant_message.user .aiassistant_message_bubble,
.aiassistant_container .message_group.user .aiassistant_message_content,
.aiassistant_container .message_group.user .aiassistant_message_bubble {
	background: var(--sl-color-primary-600, #0ea5e9);
	color: var(--sl-color-neutral-0, #ffffff);
	margin-right: var(--sl-spacing-small, 0.75rem);
	text-align: left;
}

.aiassistant_container .aiassistant_message.user .aiassistant_avatar,
.aiassistant_container .message_group.user .aiassistant_avatar {
	background: var(--sl-color-primary-700, #0284c7);
	order: 2;
}

/* Assistant messages (left-aligned) */
.aiassistant_container .aiassistant_message.assistant,
.aiassistant_container .message_group.assistant {
	justify-content: flex-start;
	text-align: left;
}

.aiassistant_container .aiassistant_message.assistant .aiassistant_message_content,
.aiassistant_container .aiassistant_message.assistant .aiassistant_message_bubble,
.aiassistant_container .message_group.assistant .aiassistant_message_content,
.aiassistant_container .message_group.assistant .aiassistant_message_bubble {
	background: var(--sl-color-neutral-50, #f8fafc);
	color: var(--sl-color-neutral-900, #0f172a);
	margin-left: var(--sl-spacing-small, 0.75rem);
	border: var(--sl-input-border-width, 1px) solid var(--sl-color-neutral-200, #e2e8f0);
	text-align: left;
}

.aiassistant_container .aiassistant_message.assistant .aiassistant_avatar,
.aiassistant_container .message_group.assistant .aiassistant_avatar {
	background: var(--sl-color-neutral-200, #e2e8f0);
	order: 1;
}

/* Message content bubbles */
.aiassistant_container .aiassistant_message_content,
.aiassistant_container .aiassistant_message_bubble {
	background: #f1f5f9;
	color: #374151;
	padding: 0.75rem 1rem;
	border-radius: 0.5rem;
	max-width: 75%;
	box-shadow: 0 1px 2px rgba(0,0,0,0.05);
	word-break: break-word;
	display: inline-block;
	font-size: 1rem;
	line-height: 1.8;
}

/* Ensure text content is visible */
.aiassistant_container .aiassistant_message_content > div,
.aiassistant_container .aiassistant_message_content > span,
.aiassistant_container .aiassistant_message_content > p,
.aiassistant_container .aiassistant_message_bubble > div,
.aiassistant_container .aiassistant_message_bubble > span,
.aiassistant_container .aiassistant_message_bubble > p {
	color: inherit !important;
	visibility: visible !important;
	opacity: 1 !important;
}

/* Text content visibility class */
.aiassistant_container .aiassistant_text_content {
	color: inherit !important;
	visibility: visible !important;
	display: block !important;
	font-size: inherit;
	font-weight: 400;
	line-height: 1.8;
}

/* Avatar styling */
.aiassistant_container .aiassistant_avatar {
	width: var(--sl-spacing-large, 2rem);
	height: var(--sl-spacing-large, 2rem);
	border-radius: var(--sl-border-radius-circle, 50%);
	display: flex;
	align-items: center;
	justify-content: center;
	font-weight: var(--sl-font-weight-semibold, 600);
	font-size: var(--sl-font-size-small, 0.875rem);
	color: var(--sl-color-neutral-600, #64748b);
	flex-shrink: 0;
}

.aiassistant_container .aiassistant_avatar.tool {
	background: linear-gradient(135deg, #14b8a6 0%, #0891b2 100%);
}

/* Message timestamps */
.aiassistant_container .aiassistant_message_time,
.aiassistant_container .message_time {
	font-size: 0.625rem;
	color: #9ca3af;
	margin-top: 0.125rem;
	text-align: right;
}

/* Tool messages */
.aiassistant_container .aiassistant_tool_message,
.aiassistant_container .aiassistant_message_bubble.aiassistant_tool_bubble {
	background: var(--sl-color-sky-50, #e0f2fe);
	border: var(--sl-input-border-width, 1px) solid var(--sl-color-sky-300, #7dd3fc);
	border-radius: var(--sl-border-radius-small, 0.25rem);
	padding: var(--sl-spacing-small, 0.75rem);
	margin: var(--sl-spacing-x-small, 0.25rem) 0;
	color: var(--sl-color-neutral-700, #374151);
	max-width: 75%;
}

.aiassistant_container .aiassistant_tool_message .aiassistant_tool_header,
.aiassistant_container .aiassistant_message_bubble.aiassistant_tool_bubble .aiassistant_tool_header {
	font-weight: var(--sl-font-weight-medium, 500);
	margin-bottom: var(--sl-spacing-x-small, 0.25rem);
	display: flex;
	align-items: center;
	gap: var(--sl-spacing-x-small, 0.25rem);
}

.aiassistant_container .aiassistant_tool_message .aiassistant_tool_icon,
.aiassistant_container .aiassistant_message_bubble.aiassistant_tool_bubble .aiassistant_tool_icon {
	font-size: var(--sl-font-size-medium, 1rem);
}

.aiassistant_container .aiassistant_tool_message .aiassistant_tool_details summary,
.aiassistant_container .aiassistant_message_bubble.aiassistant_tool_bubble .aiassistant_tool_details summary {
	cursor: pointer;
	padding: var(--sl-spacing-2x-small, 0.125rem) 0;
	color: var(--sl-color-primary-600, #0ea5e9);
	font-weight: var(--sl-font-weight-medium, 500);
}

.aiassistant_container .aiassistant_tool_message .aiassistant_tool_args,
.aiassistant_container .aiassistant_message_bubble.aiassistant_tool_bubble .aiassistant_tool_args {
	background: var(--sl-color-neutral-50, #f1f5f9);
	border: var(--sl-input-border-width, 1px) solid var(--sl-color-neutral-200, #e2e8f0);
	border-radius: var(--sl-border-radius-small, 0.125rem);
	padding: var(--sl-spacing-x-small, 0.25rem);
	margin-top: var(--sl-spacing-x-small, 0.25rem);
	font-size: var(--sl-font-size-x-small, 0.75rem);
	font-family: var(--sl-font-mono, 'Courier New', monospace);
	overflow-x: auto;
}

/* Tool results */
.aiassistant_container .aiassistant_tool_result {
	margin-top: var(--sl-spacing-small, 0.75rem);
	padding: var(--sl-spacing-small, 0.75rem);
	border-radius: var(--sl-border-radius-small, 0.25rem);
}

.aiassistant_container .aiassistant_tool_result.success {
	background: var(--sl-color-success-50, #dcfce7);
	border: var(--sl-input-border-width, 1px) solid var(--sl-color-success-200, #bbf7d0);
	color: var(--sl-color-success-700, #15803d);
}

.aiassistant_container .aiassistant_tool_result.error {
	background: var(--sl-color-danger-50, #fef2f2);
	border: var(--sl-input-border-width, 1px) solid var(--sl-color-danger-200, #fecaca);
	color: var(--sl-color-danger-700, #dc2626);
}

/* Loading states */
.aiassistant_container .aiassistant_loading {
	opacity: 0.7;
}

/* Typing indicator */
.aiassistant_container .aiassistant_typing_indicator {
	opacity: 0.8;
	display: flex;
	align-items: center;
	gap: var(--sl-spacing-2x-small, 0.125rem);
}

.aiassistant_container .aiassistant_typing_bubble,
.aiassistant_container .aiassistant_message_bubble.aiassistant_typing_bubble {
	padding: var(--sl-spacing-medium, 1rem) var(--sl-spacing-large, 1.25rem);
	background: var(--sl-color-neutral-0, #ffffff);
	border: var(--sl-input-border-width, 1px) solid var(--sl-color-neutral-200, #e2e8f0);
	margin-left: var(--sl-spacing-small, 0.75rem);
}

.aiassistant_container .aiassistant_typing_dots {
	display: flex;
	align-items: center;
	gap: var(--sl-spacing-x-small, 0.25rem);
	color: var(--sl-color-neutral-500, #6b7280);
	font-style: italic;
}

.aiassistant_container .aiassistant_typing_dot {
	width: 6px;
	height: 6px;
	border-radius: var(--sl-border-radius-circle, 50%);
	background: var(--sl-color-neutral-500, #6b7280);
	animation: typing 1.4s ease-in-out infinite both;
}

.aiassistant_container .aiassistant_typing_dot:nth-child(1) {
	animation-delay: -0.32s;
}

.aiassistant_container .aiassistant_typing_dot:nth-child(2) {
	animation-delay: -0.16s;
}

.aiassistant_container .aiassistant_typing_dot:nth-child(3) {
	animation-delay: 0;
}

/* Code formatting */
.aiassistant_container .aiassistant_message_content code,
.aiassistant_container .aiassistant_message_bubble code,
.aiassistant_container .aiassistant_text_content code {
	background: var(--sl-color-neutral-200, #e2e8f0);
	color: var(--sl-color-neutral-800, #1e293b) !important;
	padding: var(--sl-spacing-2x-small, 0.125rem) var(--sl-spacing-x-small, 0.25rem);
	border-radius: var(--sl-border-radius-small, 0.125rem);
	font-family: var(--sl-font-mono, 'Courier New', monospace);
	font-size: var(--sl-font-size-small, 0.875rem);
	white-space: pre-wrap;
	word-break: break-all;
}

.aiassistant_container .aiassistant_message_content pre,
.aiassistant_container .aiassistant_message_bubble pre {
	background: var(--sl-color-neutral-50, #f1f5f9);
	border: var(--sl-input-border-width, 1px) solid var(--sl-color-neutral-300, #cbd5e1);
	border-radius: var(--sl-border-radius-small, 0.125rem);
	padding: var(--sl-spacing-medium, 1rem);
	overflow: auto;
	margin: var(--sl-spacing-x-small, 0.25rem) 0;
	font-family: var(--sl-font-mono, 'Courier New', monospace);
	font-size: var(--sl-font-size-small, 0.875rem);
	max-width: 100%;
}

/* Widget menu styling */
.aiassistant_container .aiassistant_widget_menu {
	position: absolute;
	background: var(--sl-color-neutral-0, #ffffff);
	border: var(--sl-input-border-width, 1px) solid var(--sl-color-neutral-300, #cbd5e1);
	border-radius: var(--sl-border-radius-small, 0.25rem);
	box-shadow: var(--sl-shadow-medium, 0 4px 6px -1px rgba(0, 0, 0, 0.1));
	z-index: 1000;
	min-width: 200px;
	display: none;
}

.aiassistant_container .aiassistant_widget_menu .aiassistant_menu_item {
	padding: var(--sl-spacing-x-small, 0.25rem) var(--sl-spacing-small, 0.75rem);
	cursor: pointer;
	border-bottom: var(--sl-input-border-width, 1px) solid var(--sl-color-neutral-50, #f1f5f9);
	font-size: var(--sl-font-size-small, 0.875rem);
	color: var(--sl-color-neutral-700, #374151);
	transition: background-color var(--sl-transition-fast, 0.15s);
}

.aiassistant_container .aiassistant_widget_menu .aiassistant_menu_item:hover {
	background-color: var(--sl-color-neutral-50, #f8fafc);
}

.aiassistant_container .aiassistant_widget_menu .aiassistant_menu_item:last-child {
	border-bottom: none;
}

.aiassistant_container .aiassistant_widget_container {
	position: relative;
	display: inline-block;
}

/* Typing animation keyframes */
@keyframes typing {
	0%, 80%, 100% {
		transform: scale(0.8);
		opacity: 0.5;
	}
	40% {
		transform: scale(1);
		opacity: 1;
	}
}

/* Responsive design */
@media (max-width: 768px) {
	.aiassistant_container {
		padding: var(--sl-spacing-medium, 0.5rem);
		height: calc(100vh - 50px); /* Adjust for mobile */
	}

	.aiassistant_container .aiassistant_header {
		padding: var(--sl-spacing-x-small, 0.25rem) var(--sl-spacing-small, 0.75rem);
	}

	.aiassistant_container .aiassistant_title {
		font-size: var(--sl-font-size-medium, 1rem);
	}

	.aiassistant_container .aiassistant_messages {
		padding: var(--sl-spacing-small, 0.75rem);
		min-height: 300px;
		max-height: calc(100vh - 180px); /* Ensure proper mobile scrolling */
	}

	.aiassistant_container .aiassistant_message_content,
	.aiassistant_container .aiassistant_message_bubble {
		max-width: 85%;
		font-size: var(--sl-font-size-small, 0.875rem);
	}

	.aiassistant_container .aiassistant_empty_state {
		padding: var(--sl-spacing-large, 1.25rem);
	}

	.aiassistant_container .aiassistant_empty_state .aiassistant_empty_icon {
		font-size: var(--sl-font-size-3x-large, 3rem);
	}

	.aiassistant_container .aiassistant_empty_state .aiassistant_empty_title {
		font-size: var(--sl-font-size-large, 1.25rem);
	}

	.aiassistant_container .aiassistant_empty_state .aiassistant_empty_text {
		font-size: var(--sl-font-size-small, 0.875rem);
	}
}

/* 
 * Enhancement layer - use Shoelace variables when available
 */
:root {
	/* Use Shoelace variables as overrides when available */
	--aiassist-spacing-small: var(--sl-spacing-small, 0.75rem);
	--aiassist-spacing-medium: var(--sl-spacing-medium, 1rem);
	--aiassist-spacing-large: var(--sl-spacing-large, 1.25rem);
	--aiassist-color-primary: var(--sl-color-primary-600, #0ea5e9);
	--aiassist-color-neutral-50: var(--sl-color-neutral-50, #f8fafc);
	--aiassist-color-neutral-200: var(--sl-color-neutral-200, #e2e8f0);
}

/* Apply Shoelace variables when available */
.aiassistant_container {
	padding: var(--aiassist-spacing-medium);
}

.aiassistant_container .aiassistant_header {
	background: var(--aiassist-color-primary);
	padding: var(--aiassist-spacing-small) var(--aiassist-spacing-medium);
}

.aiassistant_container .aiassistant_messages {
	padding: var(--aiassist-spacing-large);
	background: var(--aiassist-color-neutral-50);
	border-color: var(--aiassist-color-neutral-200);
}

.aiassistant_container .aiassistant_messages > * {
	margin-bottom: var(--aiassist-spacing-medium);
}
